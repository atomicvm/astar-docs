<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Account scheme | Astar Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://astarnetwork.github.io/astar-docs/docs/quickstart/addresses"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Account scheme | Astar Docs"><meta data-rh="true" name="description" content="Using Astar Native Account Between Substrate and EVM"><meta data-rh="true" property="og:description" content="Using Astar Native Account Between Substrate and EVM"><link data-rh="true" rel="icon" href="/astar-docs/img/fav.png"><link data-rh="true" rel="canonical" href="https://astarnetwork.github.io/astar-docs/docs/quickstart/addresses"><link data-rh="true" rel="alternate" href="https://astarnetwork.github.io/astar-docs/docs/quickstart/addresses" hreflang="en"><link data-rh="true" rel="alternate" href="https://astarnetwork.github.io/astar-docs/docs/quickstart/addresses" hreflang="x-default"><link rel="stylesheet" href="/astar-docs/assets/css/styles.a7cd0fb0.css">
<link rel="preload" href="/astar-docs/assets/js/runtime~main.531394bf.js" as="script">
<link rel="preload" href="/astar-docs/assets/js/main.54d167a8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/astar-docs/"><div class="navbar__logo"><img src="/astar-docs/img/ring.svg" alt="Astar" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/astar-docs/img/ring.svg" alt="Astar" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Astar Docs</b></a><a class="navbar__item navbar__link navbar__link--active" href="/astar-docs/docs/getting-started">Docs</a><a href="https://medium.com/astar-network" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Medium</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/AstarNetwork/astar-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/astar-docs/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/astar-docs/docs/quickstart/">Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astar-docs/docs/quickstart/endpoints">Network endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astar-docs/docs/quickstart/explorers">Block explorers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astar-docs/docs/quickstart/faucet">Faucet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/astar-docs/docs/quickstart/addresses">Account scheme</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/astar-docs/docs/EVM/">EVM</a><button aria-label="Toggle the collapsible sidebar category &#x27;EVM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/astar-docs/docs/wasm/">Wasm</a><button aria-label="Toggle the collapsible sidebar category &#x27;Wasm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/astar-docs/docs/nodes/">Nodes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Nodes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/astar-docs/docs/xcm/">XCM</a><button aria-label="Toggle the collapsible sidebar category &#x27;XCM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/astar-docs/docs/integrations/">Integrations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/astar-docs/">üè†</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/astar-docs/docs/quickstart/">Quick Start</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/astar-docs/docs/quickstart/addresses">Account scheme</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Account scheme</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="using-astar-native-account-between-substrate-and-evm"><strong>Using Astar Native Account Between Substrate and EVM</strong><a class="hash-link" href="#using-astar-native-account-between-substrate-and-evm" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="introduction"><strong>Introduction</strong><a class="hash-link" href="#introduction" title="Direct link to heading">‚Äã</a></h3><p>This documentation will show you the various types of accounts that can be used within Substrate, and how you can use EVM within Substrate. As the concept of keys in Substrate is very expandable and complex, we will narrow our focus as a user who is managing keys from different layers within Substrate, such as the native blockchain layer, and the EVM layer.</p><p><strong>TL;DR:</strong></p><ul><li>Substrate supports multiple signer types.</li><li>You can add the EVM pallet to use EVM within Substrate.</li><li>Substrate native accounts are in SS58 format, while EVM accounts are in H160 format.</li><li>Although Substrate can access the EVM state, the EVM cannot access the Substrate state.</li><li>You can map the SS58 account to H160 to transfer between the two accounts.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="substrate-and-ss58"><strong>Substrate and SS58</strong><a class="hash-link" href="#substrate-and-ss58" title="Direct link to heading">‚Äã</a></h3><p>Substrate is a layer 1 blockchain framework that is used to create various blockchains with custom functionality. By default, Substrate blockchains use the SS58 address format to send and receive transactions. SS58 is a modification of Base-58-check from Bitcoin with some minor changes. Notably, the format contains an¬†<em>address type</em>¬†prefix that identifies an address as belonging to a specific network (<a href="https://docs.substrate.io/v3/advanced/ss58/" target="_blank" rel="noopener noreferrer">https://docs.substrate.io/v3/advanced/ss58/</a>).</p><p>Example of an SS58 address:¬†<code>aLoNHLwqd75cniRoF2k2DrXgsbUWacuCxqc6d6BBmvG3NVQ</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="evm-and-h160"><strong>EVM and H160</strong><a class="hash-link" href="#evm-and-h160" title="Direct link to heading">‚Äã</a></h3><p>EVM is a virtual machine that allows arbitrary code execution with transactions within Ethereum (<a href="https://ethdocs.org/en/latest/introduction/what-is-ethereum.html#ethereum-virtual-machine" target="_blank" rel="noopener noreferrer">https://ethdocs.org/en/latest/introduction/what-is-ethereum.html#ethereum-virtual-machine</a>). Although EVM started with Ethereum, with modern-day blockchains, EVM is more of a standard that allows a blockchain to be ‚ÄòEthereum-compatible‚Äô and share the vast Ethereum ecosystem within other blockchains. Substrate has a collection of pallets called the Frontier framework (<a href="https://github.com/paritytech/frontier" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/frontier</a>) that adds Ethereum compatibility and accounts alongside Substrate native environments.</p><p>Ethereum uses a 160-bit hex string as its public address, which users can send and receive transactions. On Substrate, we call this format H160, for 160-bit hash. For a blockchain to be Ethereum-compatible, they must use H160 accounts, as that is the only account format that EVM and all tools within the Ethereum ecosystem will recognize. This rule applies to Substrate chains with the EVM pallet as well.</p><p>Example of an H160 address:¬†<code>0x4C40D74739A7C95D8358191D68E6d5C77a867E12</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="accounts"><strong>Accounts</strong><a class="hash-link" href="#accounts" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="substrate-public-key-types"><strong>Substrate Public Key Types</strong><a class="hash-link" href="#substrate-public-key-types" title="Direct link to heading">‚Äã</a></h3><p>Substrate natively supports three types of accounts (<a href="https://docs.substrate.io/v3/advanced/cryptography/" target="_blank" rel="noopener noreferrer">source</a>):</p><ul><li>ECDSA: a signature scheme using the¬†<a href="https://en.bitcoin.it/wiki/Secp256k1" target="_blank" rel="noopener noreferrer">secp256k1</a>¬†curve. This is the same cryptographic algorithm used to secure¬†<a href="https://en.wikipedia.org/wiki/Bitcoin" target="_blank" rel="noopener noreferrer">Bitcoin</a>¬†and¬†<a href="https://en.wikipedia.org/wiki/Ethereum" target="_blank" rel="noopener noreferrer">Ethereum</a>.</li><li>Ed25519:¬†<a href="https://en.wikipedia.org/wiki/EdDSA#Ed25519" target="_blank" rel="noopener noreferrer">Ed25519</a>¬†is an EdDSA signature scheme using¬†<a href="https://en.wikipedia.org/wiki/Curve25519" target="_blank" rel="noopener noreferrer">Curve25519</a>. It is carefully engineered at several levels of design and implementation to achieve very high speeds without compromising security.</li><li>SR25519:¬†<a href="https://research.web3.foundation/en/latest/polkadot/keys/1-accounts-more.html" target="_blank" rel="noopener noreferrer">SR25519</a>¬†is based on the same underlying curve as¬†<a href="https://docs.substrate.io/v3/advanced/cryptography/#ed25519" target="_blank" rel="noopener noreferrer">Ed25519</a>. However, it uses Schnorr signatures instead of the EdDSA scheme. SR25519 does not expose its public keys.</li></ul><p>Users can sign transactions and invoke extrinsic calls using any of these keys from the Polkadot-js wallet or wallets based on the same framework.</p><p>Generally, the SR25519 scheme is used to generate the keys that can produce blocks using the Aura. The Ed25519 scheme with the same seed phrase as the SR25519 is used to generate the key for finalizing the block using Grandpa (<a href="https://docs.substrate.io/tutorials/v3/private-network/#alice-and-bob-start-a-blockchain" target="_blank" rel="noopener noreferrer">https://docs.substrate.io/tutorials/v3/private-network/#alice-and-bob-start-a-blockchain</a>). ECDSA is an alternative scheme for keys that can sign Substrate transactions first added to¬†<a href="https://github.com/paritytech/substrate/pull/3861" target="_blank" rel="noopener noreferrer">Substrate in 2019</a>¬†by Gavin Wood. The ECDSA scheme is used to add public key compatibility for accounts that are used in Bitcoin or Ethereum.</p><p>Although Substrate supports multiple cryptographic algorithms, for the users to receive and make transactions, the algorithm will not matter at all as all three of them will show the exact same behavior.</p><p>For example, consider the seed phrase¬†<code>chimney manage ritual space armed kick angle cram indoor valid pipe margin</code>. Using this phrase will result in the following accounts:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SR25519: XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ed25519: bBfbreU46m2NMLcvDsPMUVkfRNZm7fcXbJJ4drZXParAYaY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ECDSA: Y7hpF7NCiSbG15xvVHj4ktntqFCgBurutKaCBPnhVUV5ecn</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>With a single seed phrase, we can create three different public addresses, and by changing the cryptographic scheme, the user can control all three of these accounts.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ethereum-keys"><strong>Ethereum Keys</strong><a class="hash-link" href="#ethereum-keys" title="Direct link to heading">‚Äã</a></h3><p>Ethereum only supports the ECDSA signature scheme that is the same throughout all Ethereum-compatible networks. The major difference between Substrate ECDSA and Ethereum ECDSA is the produced address format.</p><center><img src="https://miro.medium.com/max/486/1*9rewWI0WcPnFDWdkJjAQfw.png" alt="Ethereum Keys" border="1"></center><p>To oversimplify the process, both Substrate and Ethereum ECDSA accounts will share the public key, but the final hashing algorithm is different which will produce a different result. Furthermore, Substrate accounts will encode the Blake2 hashed public key to SS58, while the Ethereum address uses a different hashing algorithm. Note that this is a very general explanation, so some technical details have been ignored.</p><p>For the end-users, the difference between which accounts they use to sign Substrate transactions or Ethereum transactions will depend on the type of wallet they use. For example, users signing with MetaMask will only be able to sign Ethereum-compatible network transactions while users using Polkadot-js wallet will only be able to sign Substrate-based transactions.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="evm-on-substrate"><strong>EVM on Substrate</strong><a class="hash-link" href="#evm-on-substrate" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="architecture"><strong>Architecture</strong><a class="hash-link" href="#architecture" title="Direct link to heading">‚Äã</a></h3><p>The architecture for a Substrate blockchain that implements the EVM pallet may seem complicated at a glance, but once you understand that the EVM is a separate sandbox with its own accounts and balances that only shares the block state as the host Substrate blockchain, then it will be much easier to understand in isolation.</p><p><img src="https://miro.medium.com/max/1400/1*WAj7eNBvh05s3RoaC7AYFA.jpeg" alt="https://miro.medium.com/max/1400/1*WAj7eNBvh05s3RoaC7AYFA.jpeg"></p><p>The overall architecture can be expressed like the above diagram. There are a couple of important points to note:</p><ul><li>The EVM environment works on top of Substrate. This means that the block height of the EVM sandbox will depend on the host Substrate network and the host Substrate network will be able to access the EVM state, but the EVM sandbox will not be able to access or mutate the host Substrate network‚Äôs state through normal means. Substrate state transition from EVM can only be achieved via custom EVM precompiled contracts.</li><li>The EVM environment exposes its own RPC endpoint. The endpoint can be exposed by implementing the¬†<a href="https://github.com/paritytech/frontier/blob/master/client/rpc/src/lib.rs" target="_blank" rel="noopener noreferrer">Frontier RPC client</a>¬†and the endpoint is¬†<a href="https://eips.ethereum.org/EIPS/eip-1474" target="_blank" rel="noopener noreferrer">EIP-1474</a>¬†compatible, which means tools and sites that work with Ethereum will be fully compatible with the EVM sandbox within Substrate. You can use MetaMask to connect to the network and view or send tokens like you would on other Ethereum-compatible chains.</li><li>The EVM environment has its own balance called the EVM deposit, which can be withdrawn by Substrate native accounts. A native Substrate SS58 address can be converted to an H160 address that is mapped to an EVM deposit, and an EVM H160 address can be converted to an SS58 address. This allows the accounts to transfer tokens from the native balance to an EVM balance, and vice versa. However, this is a lossy conversion, so you cannot convert an SS58 to H160 and back to the same SS58 address. Furthermore, you can only sign transactions within the environment that which the account was created. So for example, through normal ways, you cannot sign an EVM transaction with a native account or the other way around.</li></ul><p>If we ignore the address conversion and transaction between EVM and native Substrate balances, you can view the overall architecture of Substrate with EVM as having two separate blockchains that work from a single node. Users can use EVM with MetaMask without having to ever touch or understand Substrate, or use Substrate with Polkadot-js wallet without ever touching EVM at all.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-evm-layer-in-perspective"><strong>The EVM Layer in Perspective</strong><a class="hash-link" href="#the-evm-layer-in-perspective" title="Direct link to heading">‚Äã</a></h3><p>To illustrate the fact that the EVM pallet works on top of Substrate, consider the following example.</p><p><img src="https://miro.medium.com/max/1400/1*yr35oqgxPJsUK0uR3Aybmw.png" alt="https://miro.medium.com/max/1400/1*yr35oqgxPJsUK0uR3Aybmw.png"></p><p>On Astar mainnet¬†<a href="https://astar.subscan.io/block/539982" target="_blank" rel="noopener noreferrer">block 539982</a>, there were 6 extrinsic calls. Excluding the three intrinsic calls (calls that were executed by the blockchain), there are two Substrate balance transfers and one Ethereum transaction.</p><p><img src="https://miro.medium.com/max/1400/1*_thmN46O149p-GPMUd37UQ.png" alt="https://miro.medium.com/max/1400/1*_thmN46O149p-GPMUd37UQ.png"></p><p>If we look at the same block number with an¬†<a href="https://blockscout.com/astar/block/539982/transactions" target="_blank" rel="noopener noreferrer">EVM explorer</a>, you can see that there is only one transaction.</p><p>The Substrate RPC allows you to view the native transactions and the transactions within the EVM sandbox while accessing the chain through the EVM RPC will only allow you to view the transactions that happened within the EVM pallet.</p><p><img src="https://miro.medium.com/max/1400/1*X_FI5-GfEdx0zYBYb6U37A.png" alt="https://miro.medium.com/max/1400/1*X_FI5-GfEdx0zYBYb6U37A.png"></p><p>The Ethereum extrinsic call will emit the¬†<code>ethereum.Executed</code>¬†event which contains the caller‚Äôs H160 address, the target H160 address, and the EVM transaction hash (which is different from the Substrate transaction hash. Also note that EVM calls do not have a Substrate transaction hash). This event is formatted for Substrate networks to passively read the state transition within the EVM sandbox.</p><p><img src="https://miro.medium.com/max/1400/1*FgNXP1Edrb8mTYAbh7Id7w.png" alt="https://miro.medium.com/max/1400/1*FgNXP1Edrb8mTYAbh7Id7w.png"></p><p>Looking at the¬†<a href="https://blockscout.com/astar/tx/0x49d6f414f196442dfcd726cb2c5c61f9861d81e9074ca2e5a21ecf62c1b3aa9f/token-transfers" target="_blank" rel="noopener noreferrer">transaction hash</a>¬†from the EVM RPC will return the detailed transaction. You can see that the¬†<code>from</code>¬†and the¬†<code>to</code>¬†address is the same as the ones from the Substrate block event, though the EVM RPC will return the detailed transaction data.</p><p>This is a bridge transaction, where the user is swapping 610 WASTR tokens from another blockchain.</p><p><img src="https://miro.medium.com/max/1400/1*WT1W1ZP9w-OYxkNo6z2n-A.png" alt="https://miro.medium.com/max/1400/1*WT1W1ZP9w-OYxkNo6z2n-A.png"></p><p>Looking at the block event shows that the token minting and token burning event were emitted.</p><p>However, if we look into this account‚Äôs state transition within Substrate, something interesting will happen.</p><p><img src="https://miro.medium.com/max/1400/1*UAv99QigipjX6yAkEvpgPA.png" alt="https://miro.medium.com/max/1400/1*UAv99QigipjX6yAkEvpgPA.png"></p><p>If we look at the¬†<a href="https://astar.subscan.io/extrinsic/539982-5" target="_blank" rel="noopener noreferrer">Ethereum transaction event</a>¬†in detail, we can see the token minting event and the burning event with the correct amount. However, one interesting detail is the account. Although the EVM RPC returns an H160 address, the Substrate RPC will return an SS58 address for all accounts within the EVM sandbox. This is because, in Substrate, the default address format is always SS58.</p><p>So how does Substrate convert the address format, and how does it handle the balances?</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="evm-deposits-and-address-conversion"><strong>EVM Deposits and Address Conversion</strong><a class="hash-link" href="#evm-deposits-and-address-conversion" title="Direct link to heading">‚Äã</a></h3><p>The¬†<code>@polkadot-js/util-crypto</code>¬†package exports the function¬†<code>evmToAddress</code>. This function will take an H160 address and prefix it with¬†<code>evm:</code>, convert the string into a byte array, hash the bytes with Blake2, and encode the public key to SS58. If the provided H160 address is from a valid EVM signer (as in, the account was created from wallets like MetaMask), this will result in a mapped SS58 address. Sending tokens from an SS58 account to this mapped SS58 address will allow the original H160 account to access the funds within the EVM sandbox.</p><p>It is also possible to convert an SS58 address to an H160 address by using the¬†<code>addressToEvm</code>¬†function from the same package. Substrate converts the address by first decoding the SS58 string to retrieve the hashed public key (which is a 180-bit hash, or H180), and remove the trailing 20 bits so we result in a 160-bit hash. If the provided SS58 address is from a valid Substrate signer, the resulting string will be a mapped H160 address. If an EVM signer sends a token to this address, the tokens will be held in the EVM deposit of the original SS58 account. The account can reclaim the tokens through the¬†<code>[evm.withdraw](https://github.com/paritytech/frontier/blob/1ef659002e96ca63a9383d5b5c7aaa77cce4c9b2/frame/evm/src/lib.rs#L155)</code>¬†extrinsic call.</p><p>The EVM pallet keeps a¬†<a href="https://github.com/paritytech/frontier/blob/1ef659002e96ca63a9383d5b5c7aaa77cce4c9b2/frame/evm/src/lib.rs#L533" target="_blank" rel="noopener noreferrer">hash map</a>¬†of the H160 and SS58 accounts, which is how Substrate can associate between the mapped H160 address to a mapped SS58 address.</p><p>You might have also noticed that the address conversion is a lossy operation, meaning that you cannot reverse the conversion process. Once you convert an SS58 address to an H160 address, you cannot convert that back. So when converting an address to a valid mapped address, you must be aware of the original signer. Substrate signer can be converted from an SS58 address to an H160, and an EVM signer can be converted to an SS58 address. The other way around will not create a valid mapped address.</p><p>Now going back to the¬†<a href="https://astar.subscan.io/extrinsic/539982-5" target="_blank" rel="noopener noreferrer">extrinsic call 539982‚Äì5</a>¬†and the EVM¬†<a href="https://blockscout.com/astar/tx/0x49d6f414f196442dfcd726cb2c5c61f9861d81e9074ca2e5a21ecf62c1b3aa9f/token-transfers" target="_blank" rel="noopener noreferrer">transaction hash 0x49d6f414f196442dfcd726cb2c5c61f9861d81e9074ca2e5a21ecf62c1b3aa9f</a>. Where did the SS58 address displayed from the Substrate RPC come from?</p><p>The EVM transaction shows that address¬†<code>0x3c0561dd616cb7cc25ef728869f93c01b6225ee0</code>¬†sent 610 ASTR tokens to¬†<code>0x7cae7feb55349feadb8f84468f692450d92597bc</code>. But the Substrate event shows that address¬†<code>Z3oCmw6ndSgoWvFUU1vsvC7KK1hQNBRUKQXjJs9iLY7Pp7i</code>¬†sent 610 ASTR tokens to¬†<code>bVM2ih735Pftf2KCGh8H7CZaFfDZo8pdAextigMz8mkeYBK</code>.</p><p>One thing we can make sure of is that both of the H160 address from the EVM RPC is the original signer. This is because they were able to sign an EVM transaction. Mapped H160 address cannot sign an EVM transaction as the original signer is a Substrate account.</p><p>So let‚Äôs try converting the address to SS58. Using pseudo-code, we can express the conversion process like the following (You can use an¬†<a href="https://hoonsubin.github.io/evm-substrate-address-converter/" target="_blank" rel="noopener noreferrer">online tool</a>¬†to convert the address yourself):</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let astarAddressPrefix = 5let step1 = toByteArray([&quot;evm:&quot;, &quot;0x3c0561dd616cb7cc25ef728869f93c01b6225ee0&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let step2 = blake2Hash(step1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let step3 = ss58Encode(step2, astarAddressPrefix)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mappedSs58Address = step3mappedSs58Address == &quot;Z3oCmw6ndSgoWvFUU1vsvC7KK1hQNBRUKQXjJs9iLY7Pp7i&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can see that¬†<code>Z3oCmw6ndSgoWvFUU1vsvC7KK1hQNBRUKQXjJs9iLY7Pp7i</code>¬†is actually mapped SS58 address of¬†<code>0x3c0561dd616cb7cc25ef728869f93c01b6225ee0</code>. This is also the same for¬†<code>0x7cae7feb55349feadb8f84468f692450d92597bc</code>¬†and¬†<code>bVM2ih735Pftf2KCGh8H7CZaFfDZo8pdAextigMz8mkeYBK</code>. This is consistent with the address shown in the previous section.</p><p>Then what about converting from SS58 to H160?</p><p>Let‚Äôs say we want to convert an SS58 account¬†<code>XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK</code>¬†to a mapped H160 address. The process can be expressed like the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let step1 = ss58Decode(XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mappedH160Address = dropTrailingBytes(step1, 20)mappedH160Address == &quot;0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also see the decoded public key of an SS58 address by using the Substrate key utility:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">hoonkim@Hoons-MacBook-Pro Astar % ./target/release/astar-collator key inspect XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Key URI `XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK` is account:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Network ID/version: astar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Public key (hex):   0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed6204baeceb461cd568a7cf56</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Account ID:         0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed6204baeceb461cd568a7cf56</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Public key (SS58):  XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SS58 Address:       XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The public key for¬†<code>XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK</code>¬†is¬†<code>0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed6204baeceb461cd568a7cf56</code>¬†and the mapped H160 address is¬†<code>0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed</code>, notice the trailing¬†<code>6204baeceb461cd568a7cf56</code>¬†is gone from the public key when creating the mapped H160.</p><p>Now that we know how the address conversion works and how the Substrate RPC will display EVM accounts, let‚Äôs send a token to a mapped address and access it from an EVM account, and withdraw the EVM deposit from a Substrate account.</p><p>For this example, I created two accounts from two different wallets:</p><ul><li>MetaMask:¬†<code>0xA843c5d2B2dFc45e6799EAE9b8dbEE0189e6CcAa</code></li><li>Polkadot-js:¬†<code>ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd</code></li></ul><p>Now let‚Äôs send 10 ASTR tokens from a Substrate account to my MetaMask account that can only access the EVM sandbox.</p><p>To do this, first, I must convert the MetaMask address to a mapped SS58 address. Converting¬†<code>0xA843c5d2B2dFc45e6799EAE9b8dbEE0189e6CcAa</code>¬†will give me¬†<code>ZaZgWyUczTxo8Zi8V4frbdHtnjbPr8RE24b3qCjCaMsKUfM</code><strong>.</strong></p><center><img src="https://miro.medium.com/max/718/1*vMquH0BTPFiwyA1GUpVTGw.png" alt="MetaMask" border="1"></center><p>Now when I send 10 tokens to this SS58 address from polkadot-js (<a href="https://astar.subscan.io/extrinsic/540604-2?event=540604-10" target="_blank" rel="noopener noreferrer">https://astar.subscan.io/extrinsic/540604-2?event=540604-10</a>), the balance will appear on my MetaMask.</p><p><img src="https://miro.medium.com/max/1400/1*N11gFUx9LSfMcez8F25_Gg.png" alt="https://miro.medium.com/max/1400/1*N11gFUx9LSfMcez8F25_Gg.png"></p><p>The balance change is also reflected on the¬†<a href="https://blockscout.com/astar/address/0xA843c5d2B2dFc45e6799EAE9b8dbEE0189e6CcAa/transactions" target="_blank" rel="noopener noreferrer">EVM explorer</a>. However, when we look at the block event, we will not see any block events for this transfer as I sent the tokens within the Substrate layer with a Substrate signer. So this event will not be accessible within EVM, even though it is visible within Substrate RPC.</p><p>Now let‚Äôs send the tokens back to the SS58 account. Converting¬†<code>ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd</code>¬†will give me¬†<code>0xb2aed18d6495133a43dd6ecd9a5abd1fcae57150</code><strong>.</strong></p><p><img src="https://miro.medium.com/max/1400/1*CGXs0NoAbnoflS-rb9qqhQ.png" alt="https://miro.medium.com/max/1400/1*CGXs0NoAbnoflS-rb9qqhQ.png"></p><p>I have sent 9.99 tokens (minus gas fee) to the¬†<a href="https://blockscout.com/astar/tx/0xee1da0d478cf2987b4a72f2869584d8be95468b42159db437a0772bb4d8cec94/internal-transactions" target="_blank" rel="noopener noreferrer">mapped H160 account</a>. However, this token will not go directly to the Substrate balance of account¬†<code>ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd</code>. Instead, this token is kept in the EVM deposit, which is essentially the balance of the mapped H160 account within the EVM sandbox. To withdraw the tokens in the EVM deposit, the original SS58 account has to call the¬†<code>evm.withdraw</code>¬†function.</p><p><img src="https://miro.medium.com/max/1400/1*Il4gL4kSt-lHQ_uUfJ_U1Q.png" alt="https://miro.medium.com/max/1400/1*Il4gL4kSt-lHQ_uUfJ_U1Q.png"></p><p>This function will require the parameter of the mapped H160 address, and the number of tokens the account wishes to withdraw. I will withdraw 9.9 tokens using the polkadot-js portal for this example.</p><p><img src="https://miro.medium.com/max/1400/1*heSa3DbmokVHgXKAjmxJ4w.png" alt="https://miro.medium.com/max/1400/1*heSa3DbmokVHgXKAjmxJ4w.png"></p><p>You can see that after¬†<a href="https://astar.subscan.io/extrinsic/540712-2" target="_blank" rel="noopener noreferrer">calling the function</a>, the balance of¬†<code>ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd</code>¬†has increased by 9.9 ASTR tokens. With this, I was able to transfer back and forth between an EVM account to a Substrate account.</p><p>And that is all you need to know about using EVM within Substrate!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/AstarNetwork/astar-docs/tree/main/docs/quickstart/addresses.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/astar-docs/docs/quickstart/faucet"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Faucet</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/astar-docs/docs/EVM/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">EVM</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-astar-native-account-between-substrate-and-evm" class="table-of-contents__link toc-highlight"><strong>Using Astar Native Account Between Substrate and EVM</strong></a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight"><strong>Introduction</strong></a></li><li><a href="#substrate-and-ss58" class="table-of-contents__link toc-highlight"><strong>Substrate and SS58</strong></a></li><li><a href="#evm-and-h160" class="table-of-contents__link toc-highlight"><strong>EVM and H160</strong></a></li></ul></li><li><a href="#accounts" class="table-of-contents__link toc-highlight"><strong>Accounts</strong></a><ul><li><a href="#substrate-public-key-types" class="table-of-contents__link toc-highlight"><strong>Substrate Public Key Types</strong></a></li><li><a href="#ethereum-keys" class="table-of-contents__link toc-highlight"><strong>Ethereum Keys</strong></a></li></ul></li><li><a href="#evm-on-substrate" class="table-of-contents__link toc-highlight"><strong>EVM on Substrate</strong></a><ul><li><a href="#architecture" class="table-of-contents__link toc-highlight"><strong>Architecture</strong></a></li><li><a href="#the-evm-layer-in-perspective" class="table-of-contents__link toc-highlight"><strong>The EVM Layer in Perspective</strong></a></li><li><a href="#evm-deposits-and-address-conversion" class="table-of-contents__link toc-highlight"><strong>EVM Deposits and Address Conversion</strong></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/astar-docs/docs/getting-started">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/mWGt9bH59s" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/AstarNetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/astar-network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/AstarNetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Astar Developers Hub.</div></div></div></footer></div>
<script src="/astar-docs/assets/js/runtime~main.531394bf.js"></script>
<script src="/astar-docs/assets/js/main.54d167a8.js"></script>
</body>
</html>