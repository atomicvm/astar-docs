"use strict";(self.webpackChunkdocs_1=self.webpackChunkdocs_1||[]).push([[6329],{3905:function(e,t,a){a.d(t,{Zo:function(){return h},kt:function(){return u}});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},h=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,r=e.originalType,c=e.parentName,h=i(e,["components","mdxType","originalType","parentName"]),p=l(a),u=s,m=p["".concat(c,".").concat(u)]||p[u]||d[u]||r;return a?n.createElement(m,o(o({ref:t},h),{},{components:a})):n.createElement(m,o({ref:t},h))}));function u(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=a.length,o=new Array(r);o[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:s,o[1]=i;for(var l=2;l<r;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},7762:function(e,t,a){a.r(t),a.d(t,{assets:function(){return h},contentTitle:function(){return c},default:function(){return u},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return d}});var n=a(7462),s=a(3366),r=(a(7294),a(3905)),o=["components"],i={sidebar_position:5},c="Account scheme",l={unversionedId:"quickstart/addresses",id:"quickstart/addresses",title:"Account scheme",description:"Using Astar Native Account Between Substrate and EVM",source:"@site/docs/quickstart/addresses.md",sourceDirName:"quickstart",slug:"/quickstart/addresses",permalink:"/astar-docs/docs/quickstart/addresses",editUrl:"https://github.com/AstarNetwork/astar-docs/tree/main/docs/quickstart/addresses.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Faucet",permalink:"/astar-docs/docs/quickstart/faucet"},next:{title:"EVM",permalink:"/astar-docs/docs/EVM/"}},h={},d=[{value:"<strong>Using Astar Native Account Between Substrate and EVM</strong>",id:"using-astar-native-account-between-substrate-and-evm",level:2},{value:"<strong>Introduction</strong>",id:"introduction",level:3},{value:"<strong>Substrate and SS58</strong>",id:"substrate-and-ss58",level:3},{value:"<strong>EVM and H160</strong>",id:"evm-and-h160",level:3},{value:"<strong>Accounts</strong>",id:"accounts",level:2},{value:"<strong>Substrate Public Key Types</strong>",id:"substrate-public-key-types",level:3},{value:"<strong>Ethereum Keys</strong>",id:"ethereum-keys",level:3},{value:"<strong>EVM on Substrate</strong>",id:"evm-on-substrate",level:2},{value:"<strong>Architecture</strong>",id:"architecture",level:3},{value:"<strong>The EVM Layer in Perspective</strong>",id:"the-evm-layer-in-perspective",level:3},{value:"<strong>EVM Deposits and Address Conversion</strong>",id:"evm-deposits-and-address-conversion",level:3}],p={toc:d};function u(e){var t=e.components,a=(0,s.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"account-scheme"},"Account scheme"),(0,r.kt)("h2",{id:"using-astar-native-account-between-substrate-and-evm"},(0,r.kt)("strong",{parentName:"h2"},"Using Astar Native Account Between Substrate and EVM")),(0,r.kt)("h3",{id:"introduction"},(0,r.kt)("strong",{parentName:"h3"},"Introduction")),(0,r.kt)("p",null,"This documentation will show you the various types of accounts that can be used within Substrate, and how you can use EVM within Substrate. As the concept of keys in Substrate is very expandable and complex, we will narrow our focus as a user who is managing keys from different layers within Substrate, such as the native blockchain layer, and the EVM layer."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Substrate supports multiple signer types."),(0,r.kt)("li",{parentName:"ul"},"You can add the EVM pallet to use EVM within Substrate."),(0,r.kt)("li",{parentName:"ul"},"Substrate native accounts are in SS58 format, while EVM accounts are in H160 format."),(0,r.kt)("li",{parentName:"ul"},"Although Substrate can access the EVM state, the EVM cannot access the Substrate state."),(0,r.kt)("li",{parentName:"ul"},"You can map the SS58 account to H160 to transfer between the two accounts.")),(0,r.kt)("h3",{id:"substrate-and-ss58"},(0,r.kt)("strong",{parentName:"h3"},"Substrate and SS58")),(0,r.kt)("p",null,"Substrate is a layer 1 blockchain framework that is used to create various blockchains with custom functionality. By default, Substrate blockchains use the SS58 address format to send and receive transactions. SS58 is a modification of Base-58-check from Bitcoin with some minor changes. Notably, the format contains an\xa0",(0,r.kt)("em",{parentName:"p"},"address type"),"\xa0prefix that identifies an address as belonging to a specific network (",(0,r.kt)("a",{parentName:"p",href:"https://docs.substrate.io/v3/advanced/ss58/"},"https://docs.substrate.io/v3/advanced/ss58/"),")."),(0,r.kt)("p",null,"Example of an SS58 address:\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"aLoNHLwqd75cniRoF2k2DrXgsbUWacuCxqc6d6BBmvG3NVQ"),"."),(0,r.kt)("h3",{id:"evm-and-h160"},(0,r.kt)("strong",{parentName:"h3"},"EVM and H160")),(0,r.kt)("p",null,"EVM is a virtual machine that allows arbitrary code execution with transactions within Ethereum (",(0,r.kt)("a",{parentName:"p",href:"https://ethdocs.org/en/latest/introduction/what-is-ethereum.html#ethereum-virtual-machine"},"https://ethdocs.org/en/latest/introduction/what-is-ethereum.html#ethereum-virtual-machine"),"). Although EVM started with Ethereum, with modern-day blockchains, EVM is more of a standard that allows a blockchain to be \u2018Ethereum-compatible\u2019 and share the vast Ethereum ecosystem within other blockchains. Substrate has a collection of pallets called the Frontier framework (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/paritytech/frontier"},"https://github.com/paritytech/frontier"),") that adds Ethereum compatibility and accounts alongside Substrate native environments."),(0,r.kt)("p",null,"Ethereum uses a 160-bit hex string as its public address, which users can send and receive transactions. On Substrate, we call this format H160, for 160-bit hash. For a blockchain to be Ethereum-compatible, they must use H160 accounts, as that is the only account format that EVM and all tools within the Ethereum ecosystem will recognize. This rule applies to Substrate chains with the EVM pallet as well."),(0,r.kt)("p",null,"Example of an H160 address:\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x4C40D74739A7C95D8358191D68E6d5C77a867E12"),"."),(0,r.kt)("h2",{id:"accounts"},(0,r.kt)("strong",{parentName:"h2"},"Accounts")),(0,r.kt)("h3",{id:"substrate-public-key-types"},(0,r.kt)("strong",{parentName:"h3"},"Substrate Public Key Types")),(0,r.kt)("p",null,"Substrate natively supports three types of accounts (",(0,r.kt)("a",{parentName:"p",href:"https://docs.substrate.io/v3/advanced/cryptography/"},"source"),"):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ECDSA: a signature scheme using the\xa0",(0,r.kt)("a",{parentName:"li",href:"https://en.bitcoin.it/wiki/Secp256k1"},"secp256k1"),"\xa0curve. This is the same cryptographic algorithm used to secure\xa0",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Bitcoin"},"Bitcoin"),"\xa0and\xa0",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Ethereum"},"Ethereum"),"."),(0,r.kt)("li",{parentName:"ul"},"Ed25519:\xa0",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/EdDSA#Ed25519"},"Ed25519"),"\xa0is an EdDSA signature scheme using\xa0",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Curve25519"},"Curve25519"),". It is carefully engineered at several levels of design and implementation to achieve very high speeds without compromising security."),(0,r.kt)("li",{parentName:"ul"},"SR25519:\xa0",(0,r.kt)("a",{parentName:"li",href:"https://research.web3.foundation/en/latest/polkadot/keys/1-accounts-more.html"},"SR25519"),"\xa0is based on the same underlying curve as\xa0",(0,r.kt)("a",{parentName:"li",href:"https://docs.substrate.io/v3/advanced/cryptography/#ed25519"},"Ed25519"),". However, it uses Schnorr signatures instead of the EdDSA scheme. SR25519 does not expose its public keys.")),(0,r.kt)("p",null,"Users can sign transactions and invoke extrinsic calls using any of these keys from the Polkadot-js wallet or wallets based on the same framework."),(0,r.kt)("p",null,"Generally, the SR25519 scheme is used to generate the keys that can produce blocks using the Aura. The Ed25519 scheme with the same seed phrase as the SR25519 is used to generate the key for finalizing the block using Grandpa (",(0,r.kt)("a",{parentName:"p",href:"https://docs.substrate.io/tutorials/v3/private-network/#alice-and-bob-start-a-blockchain"},"https://docs.substrate.io/tutorials/v3/private-network/#alice-and-bob-start-a-blockchain"),"). ECDSA is an alternative scheme for keys that can sign Substrate transactions first added to\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/paritytech/substrate/pull/3861"},"Substrate in 2019"),"\xa0by Gavin Wood. The ECDSA scheme is used to add public key compatibility for accounts that are used in Bitcoin or Ethereum."),(0,r.kt)("p",null,"Although Substrate supports multiple cryptographic algorithms, for the users to receive and make transactions, the algorithm will not matter at all as all three of them will show the exact same behavior."),(0,r.kt)("p",null,"For example, consider the seed phrase\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"chimney manage ritual space armed kick angle cram indoor valid pipe margin"),". Using this phrase will result in the following accounts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"SR25519: XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK\nEd25519: bBfbreU46m2NMLcvDsPMUVkfRNZm7fcXbJJ4drZXParAYaY\nECDSA: Y7hpF7NCiSbG15xvVHj4ktntqFCgBurutKaCBPnhVUV5ecn\n")),(0,r.kt)("p",null,"With a single seed phrase, we can create three different public addresses, and by changing the cryptographic scheme, the user can control all three of these accounts."),(0,r.kt)("h3",{id:"ethereum-keys"},(0,r.kt)("strong",{parentName:"h3"},"Ethereum Keys")),(0,r.kt)("p",null,"Ethereum only supports the ECDSA signature scheme that is the same throughout all Ethereum-compatible networks. The major difference between Substrate ECDSA and Ethereum ECDSA is the produced address format."),(0,r.kt)("center",null,(0,r.kt)("img",{src:"https://miro.medium.com/max/486/1*9rewWI0WcPnFDWdkJjAQfw.png",alt:"Ethereum Keys",border:"1"})),(0,r.kt)("p",null,"To oversimplify the process, both Substrate and Ethereum ECDSA accounts will share the public key, but the final hashing algorithm is different which will produce a different result. Furthermore, Substrate accounts will encode the Blake2 hashed public key to SS58, while the Ethereum address uses a different hashing algorithm. Note that this is a very general explanation, so some technical details have been ignored."),(0,r.kt)("p",null,"For the end-users, the difference between which accounts they use to sign Substrate transactions or Ethereum transactions will depend on the type of wallet they use. For example, users signing with MetaMask will only be able to sign Ethereum-compatible network transactions while users using Polkadot-js wallet will only be able to sign Substrate-based transactions."),(0,r.kt)("h2",{id:"evm-on-substrate"},(0,r.kt)("strong",{parentName:"h2"},"EVM on Substrate")),(0,r.kt)("h3",{id:"architecture"},(0,r.kt)("strong",{parentName:"h3"},"Architecture")),(0,r.kt)("p",null,"The architecture for a Substrate blockchain that implements the EVM pallet may seem complicated at a glance, but once you understand that the EVM is a separate sandbox with its own accounts and balances that only shares the block state as the host Substrate blockchain, then it will be much easier to understand in isolation."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*WAj7eNBvh05s3RoaC7AYFA.jpeg",alt:"https://miro.medium.com/max/1400/1*WAj7eNBvh05s3RoaC7AYFA.jpeg"})),(0,r.kt)("p",null,"The overall architecture can be expressed like the above diagram. There are a couple of important points to note:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The EVM environment works on top of Substrate. This means that the block height of the EVM sandbox will depend on the host Substrate network and the host Substrate network will be able to access the EVM state, but the EVM sandbox will not be able to access or mutate the host Substrate network\u2019s state through normal means. Substrate state transition from EVM can only be achieved via custom EVM precompiled contracts."),(0,r.kt)("li",{parentName:"ul"},"The EVM environment exposes its own RPC endpoint. The endpoint can be exposed by implementing the\xa0",(0,r.kt)("a",{parentName:"li",href:"https://github.com/paritytech/frontier/blob/master/client/rpc/src/lib.rs"},"Frontier RPC client"),"\xa0and the endpoint is\xa0",(0,r.kt)("a",{parentName:"li",href:"https://eips.ethereum.org/EIPS/eip-1474"},"EIP-1474"),"\xa0compatible, which means tools and sites that work with Ethereum will be fully compatible with the EVM sandbox within Substrate. You can use MetaMask to connect to the network and view or send tokens like you would on other Ethereum-compatible chains."),(0,r.kt)("li",{parentName:"ul"},"The EVM environment has its own balance called the EVM deposit, which can be withdrawn by Substrate native accounts. A native Substrate SS58 address can be converted to an H160 address that is mapped to an EVM deposit, and an EVM H160 address can be converted to an SS58 address. This allows the accounts to transfer tokens from the native balance to an EVM balance, and vice versa. However, this is a lossy conversion, so you cannot convert an SS58 to H160 and back to the same SS58 address. Furthermore, you can only sign transactions within the environment that which the account was created. So for example, through normal ways, you cannot sign an EVM transaction with a native account or the other way around.")),(0,r.kt)("p",null,"If we ignore the address conversion and transaction between EVM and native Substrate balances, you can view the overall architecture of Substrate with EVM as having two separate blockchains that work from a single node. Users can use EVM with MetaMask without having to ever touch or understand Substrate, or use Substrate with Polkadot-js wallet without ever touching EVM at all."),(0,r.kt)("h3",{id:"the-evm-layer-in-perspective"},(0,r.kt)("strong",{parentName:"h3"},"The EVM Layer in Perspective")),(0,r.kt)("p",null,"To illustrate the fact that the EVM pallet works on top of Substrate, consider the following example."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*yr35oqgxPJsUK0uR3Aybmw.png",alt:"https://miro.medium.com/max/1400/1*yr35oqgxPJsUK0uR3Aybmw.png"})),(0,r.kt)("p",null,"On Astar mainnet\xa0",(0,r.kt)("a",{parentName:"p",href:"https://astar.subscan.io/block/539982"},"block 539982"),", there were 6 extrinsic calls. Excluding the three intrinsic calls (calls that were executed by the blockchain), there are two Substrate balance transfers and one Ethereum transaction."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*_thmN46O149p-GPMUd37UQ.png",alt:"https://miro.medium.com/max/1400/1*_thmN46O149p-GPMUd37UQ.png"})),(0,r.kt)("p",null,"If we look at the same block number with an\xa0",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/astar/block/539982/transactions"},"EVM explorer"),", you can see that there is only one transaction."),(0,r.kt)("p",null,"The Substrate RPC allows you to view the native transactions and the transactions within the EVM sandbox while accessing the chain through the EVM RPC will only allow you to view the transactions that happened within the EVM pallet."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*X_FI5-GfEdx0zYBYb6U37A.png",alt:"https://miro.medium.com/max/1400/1*X_FI5-GfEdx0zYBYb6U37A.png"})),(0,r.kt)("p",null,"The Ethereum extrinsic call will emit the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"ethereum.Executed"),"\xa0event which contains the caller\u2019s H160 address, the target H160 address, and the EVM transaction hash (which is different from the Substrate transaction hash. Also note that EVM calls do not have a Substrate transaction hash). This event is formatted for Substrate networks to passively read the state transition within the EVM sandbox."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*FgNXP1Edrb8mTYAbh7Id7w.png",alt:"https://miro.medium.com/max/1400/1*FgNXP1Edrb8mTYAbh7Id7w.png"})),(0,r.kt)("p",null,"Looking at the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/astar/tx/0x49d6f414f196442dfcd726cb2c5c61f9861d81e9074ca2e5a21ecf62c1b3aa9f/token-transfers"},"transaction hash"),"\xa0from the EVM RPC will return the detailed transaction. You can see that the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"from"),"\xa0and the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"to"),"\xa0address is the same as the ones from the Substrate block event, though the EVM RPC will return the detailed transaction data."),(0,r.kt)("p",null,"This is a bridge transaction, where the user is swapping 610 WASTR tokens from another blockchain."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*WT1W1ZP9w-OYxkNo6z2n-A.png",alt:"https://miro.medium.com/max/1400/1*WT1W1ZP9w-OYxkNo6z2n-A.png"})),(0,r.kt)("p",null,"Looking at the block event shows that the token minting and token burning event were emitted."),(0,r.kt)("p",null,"However, if we look into this account\u2019s state transition within Substrate, something interesting will happen."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*UAv99QigipjX6yAkEvpgPA.png",alt:"https://miro.medium.com/max/1400/1*UAv99QigipjX6yAkEvpgPA.png"})),(0,r.kt)("p",null,"If we look at the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://astar.subscan.io/extrinsic/539982-5"},"Ethereum transaction event"),"\xa0in detail, we can see the token minting event and the burning event with the correct amount. However, one interesting detail is the account. Although the EVM RPC returns an H160 address, the Substrate RPC will return an SS58 address for all accounts within the EVM sandbox. This is because, in Substrate, the default address format is always SS58."),(0,r.kt)("p",null,"So how does Substrate convert the address format, and how does it handle the balances?"),(0,r.kt)("h3",{id:"evm-deposits-and-address-conversion"},(0,r.kt)("strong",{parentName:"h3"},"EVM Deposits and Address Conversion")),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"@polkadot-js/util-crypto"),"\xa0package exports the function\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"evmToAddress"),". This function will take an H160 address and prefix it with\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"evm:"),", convert the string into a byte array, hash the bytes with Blake2, and encode the public key to SS58. If the provided H160 address is from a valid EVM signer (as in, the account was created from wallets like MetaMask), this will result in a mapped SS58 address. Sending tokens from an SS58 account to this mapped SS58 address will allow the original H160 account to access the funds within the EVM sandbox."),(0,r.kt)("p",null,"It is also possible to convert an SS58 address to an H160 address by using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addressToEvm"),"\xa0function from the same package. Substrate converts the address by first decoding the SS58 string to retrieve the hashed public key (which is a 180-bit hash, or H180), and remove the trailing 20 bits so we result in a 160-bit hash. If the provided SS58 address is from a valid Substrate signer, the resulting string will be a mapped H160 address. If an EVM signer sends a token to this address, the tokens will be held in the EVM deposit of the original SS58 account. The account can reclaim the tokens through the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"[evm.withdraw](https://github.com/paritytech/frontier/blob/1ef659002e96ca63a9383d5b5c7aaa77cce4c9b2/frame/evm/src/lib.rs#L155)"),"\xa0extrinsic call."),(0,r.kt)("p",null,"The EVM pallet keeps a\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/paritytech/frontier/blob/1ef659002e96ca63a9383d5b5c7aaa77cce4c9b2/frame/evm/src/lib.rs#L533"},"hash map"),"\xa0of the H160 and SS58 accounts, which is how Substrate can associate between the mapped H160 address to a mapped SS58 address."),(0,r.kt)("p",null,"You might have also noticed that the address conversion is a lossy operation, meaning that you cannot reverse the conversion process. Once you convert an SS58 address to an H160 address, you cannot convert that back. So when converting an address to a valid mapped address, you must be aware of the original signer. Substrate signer can be converted from an SS58 address to an H160, and an EVM signer can be converted to an SS58 address. The other way around will not create a valid mapped address."),(0,r.kt)("p",null,"Now going back to the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://astar.subscan.io/extrinsic/539982-5"},"extrinsic call 539982\u20135"),"\xa0and the EVM\xa0",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/astar/tx/0x49d6f414f196442dfcd726cb2c5c61f9861d81e9074ca2e5a21ecf62c1b3aa9f/token-transfers"},"transaction hash 0x49d6f414f196442dfcd726cb2c5c61f9861d81e9074ca2e5a21ecf62c1b3aa9f"),". Where did the SS58 address displayed from the Substrate RPC come from?"),(0,r.kt)("p",null,"The EVM transaction shows that address\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x3c0561dd616cb7cc25ef728869f93c01b6225ee0"),"\xa0sent 610 ASTR tokens to\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x7cae7feb55349feadb8f84468f692450d92597bc"),". But the Substrate event shows that address\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Z3oCmw6ndSgoWvFUU1vsvC7KK1hQNBRUKQXjJs9iLY7Pp7i"),"\xa0sent 610 ASTR tokens to\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"bVM2ih735Pftf2KCGh8H7CZaFfDZo8pdAextigMz8mkeYBK"),"."),(0,r.kt)("p",null,"One thing we can make sure of is that both of the H160 address from the EVM RPC is the original signer. This is because they were able to sign an EVM transaction. Mapped H160 address cannot sign an EVM transaction as the original signer is a Substrate account."),(0,r.kt)("p",null,"So let\u2019s try converting the address to SS58. Using pseudo-code, we can express the conversion process like the following (You can use an\xa0",(0,r.kt)("a",{parentName:"p",href:"https://hoonsubin.github.io/evm-substrate-address-converter/"},"online tool"),"\xa0to convert the address yourself):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'let astarAddressPrefix = 5let step1 = toByteArray(["evm:", "0x3c0561dd616cb7cc25ef728869f93c01b6225ee0"])\nlet step2 = blake2Hash(step1)\nlet step3 = ss58Encode(step2, astarAddressPrefix)\nlet mappedSs58Address = step3mappedSs58Address == "Z3oCmw6ndSgoWvFUU1vsvC7KK1hQNBRUKQXjJs9iLY7Pp7i"\n')),(0,r.kt)("p",null,"We can see that\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Z3oCmw6ndSgoWvFUU1vsvC7KK1hQNBRUKQXjJs9iLY7Pp7i"),"\xa0is actually mapped SS58 address of\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x3c0561dd616cb7cc25ef728869f93c01b6225ee0"),". This is also the same for\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x7cae7feb55349feadb8f84468f692450d92597bc"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"bVM2ih735Pftf2KCGh8H7CZaFfDZo8pdAextigMz8mkeYBK"),". This is consistent with the address shown in the previous section."),(0,r.kt)("p",null,"Then what about converting from SS58 to H160?"),(0,r.kt)("p",null,"Let\u2019s say we want to convert an SS58 account\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK"),"\xa0to a mapped H160 address. The process can be expressed like the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'let step1 = ss58Decode(XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK)\nlet mappedH160Address = dropTrailingBytes(step1, 20)mappedH160Address == "0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed"\n')),(0,r.kt)("p",null,"You can also see the decoded public key of an SS58 address by using the Substrate key utility:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"hoonkim@Hoons-MacBook-Pro Astar % ./target/release/astar-collator key inspect XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK\nPublic Key URI `XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK` is account:\n  Network ID/version: astar\n  Public key (hex):   0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed6204baeceb461cd568a7cf56\n  Account ID:         0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed6204baeceb461cd568a7cf56\n  Public key (SS58):  XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK\n  SS58 Address:       XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK\n")),(0,r.kt)("p",null,"The public key for\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"XdBhqfbg5Jsqp5YgNJVNLzMMBrzGsmBkZypS5Z7nr214fkK"),"\xa0is\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed6204baeceb461cd568a7cf56"),"\xa0and the mapped H160 address is\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0x4aa7df162dc5543a3c1a5e216d16d260f9ead5ed"),", notice the trailing\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"6204baeceb461cd568a7cf56"),"\xa0is gone from the public key when creating the mapped H160."),(0,r.kt)("p",null,"Now that we know how the address conversion works and how the Substrate RPC will display EVM accounts, let\u2019s send a token to a mapped address and access it from an EVM account, and withdraw the EVM deposit from a Substrate account."),(0,r.kt)("p",null,"For this example, I created two accounts from two different wallets:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MetaMask:\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"0xA843c5d2B2dFc45e6799EAE9b8dbEE0189e6CcAa")),(0,r.kt)("li",{parentName:"ul"},"Polkadot-js:\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd"))),(0,r.kt)("p",null,"Now let\u2019s send 10 ASTR tokens from a Substrate account to my MetaMask account that can only access the EVM sandbox."),(0,r.kt)("p",null,"To do this, first, I must convert the MetaMask address to a mapped SS58 address. Converting\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0xA843c5d2B2dFc45e6799EAE9b8dbEE0189e6CcAa"),"\xa0will give me\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"ZaZgWyUczTxo8Zi8V4frbdHtnjbPr8RE24b3qCjCaMsKUfM"),(0,r.kt)("strong",{parentName:"p"},".")),(0,r.kt)("center",null,(0,r.kt)("img",{src:"https://miro.medium.com/max/718/1*vMquH0BTPFiwyA1GUpVTGw.png",alt:"MetaMask",border:"1"})),(0,r.kt)("p",null,"Now when I send 10 tokens to this SS58 address from polkadot-js (",(0,r.kt)("a",{parentName:"p",href:"https://astar.subscan.io/extrinsic/540604-2?event=540604-10"},"https://astar.subscan.io/extrinsic/540604-2?event=540604-10"),"), the balance will appear on my MetaMask."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*N11gFUx9LSfMcez8F25_Gg.png",alt:"https://miro.medium.com/max/1400/1*N11gFUx9LSfMcez8F25_Gg.png"})),(0,r.kt)("p",null,"The balance change is also reflected on the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/astar/address/0xA843c5d2B2dFc45e6799EAE9b8dbEE0189e6CcAa/transactions"},"EVM explorer"),". However, when we look at the block event, we will not see any block events for this transfer as I sent the tokens within the Substrate layer with a Substrate signer. So this event will not be accessible within EVM, even though it is visible within Substrate RPC."),(0,r.kt)("p",null,"Now let\u2019s send the tokens back to the SS58 account. Converting\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd"),"\xa0will give me\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"0xb2aed18d6495133a43dd6ecd9a5abd1fcae57150"),(0,r.kt)("strong",{parentName:"p"},".")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*CGXs0NoAbnoflS-rb9qqhQ.png",alt:"https://miro.medium.com/max/1400/1*CGXs0NoAbnoflS-rb9qqhQ.png"})),(0,r.kt)("p",null,"I have sent 9.99 tokens (minus gas fee) to the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://blockscout.com/astar/tx/0xee1da0d478cf2987b4a72f2869584d8be95468b42159db437a0772bb4d8cec94/internal-transactions"},"mapped H160 account"),". However, this token will not go directly to the Substrate balance of account\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd"),". Instead, this token is kept in the EVM deposit, which is essentially the balance of the mapped H160 account within the EVM sandbox. To withdraw the tokens in the EVM deposit, the original SS58 account has to call the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"evm.withdraw"),"\xa0function."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*Il4gL4kSt-lHQ_uUfJ_U1Q.png",alt:"https://miro.medium.com/max/1400/1*Il4gL4kSt-lHQ_uUfJ_U1Q.png"})),(0,r.kt)("p",null,"This function will require the parameter of the mapped H160 address, and the number of tokens the account wishes to withdraw. I will withdraw 9.9 tokens using the polkadot-js portal for this example."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://miro.medium.com/max/1400/1*heSa3DbmokVHgXKAjmxJ4w.png",alt:"https://miro.medium.com/max/1400/1*heSa3DbmokVHgXKAjmxJ4w.png"})),(0,r.kt)("p",null,"You can see that after\xa0",(0,r.kt)("a",{parentName:"p",href:"https://astar.subscan.io/extrinsic/540712-2"},"calling the function"),", the balance of\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"ZyakNoVJnDXcKFLYfnsTY9EZLYd6PHifzXG5jFyTbSM9dvd"),"\xa0has increased by 9.9 ASTR tokens. With this, I was able to transfer back and forth between an EVM account to a Substrate account."),(0,r.kt)("p",null,"And that is all you need to know about using EVM within Substrate!"))}u.isMDXComponent=!0}}]);